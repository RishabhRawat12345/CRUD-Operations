#!/usr/bin/env node
import{resolve as b}from"path";import{Command as N}from"commander";var f="1.1.3";import{readFile as E,unlink as R,writeFile as P}from"fs/promises";import{basename as $,dirname as C,join as g}from"path";import{pathToFileURL as I}from"url";import{build as S}from"esbuild";import{access as j}from"fs/promises";import{dirname as A,join as O}from"path";function*u(t){let o=t._router?.stack??t.router?.stack;if(!(!o||!Array.isArray(o))){for(let e of o)if(e){if(e.route?.path&&e.route.methods)for(let i of Object.keys(e.route.methods))yield{method:i.toUpperCase(),path:e.route.path};else if(e.name==="router"&&e.handle?.stack&&Array.isArray(e.handle.stack)){let i=e.regexp?.source?.replace("\\/?(?=\\/|$)","").replace("^","").replace("$","")||"";for(let r of e.handle.stack)if(r?.route?.path&&r.route.methods)for(let s of Object.keys(r.route.methods))yield{method:s.toUpperCase(),path:i+r.route.path}}}}}async function h(t){let o=t;for(;;)try{let e=O(o,"package.json");return await j(e),o}catch{let e=A(o);if(e===o)return null;o=e}}async function J(t){let o=C(t),e=g(o,`${$(t,".ts")}-${Date.now()}.js`),i=await h(o)||o,r=g(i,"package.json"),s=[];try{let p=JSON.parse(await E(r,"utf-8"));s=Object.keys(p.dependencies||{})}catch{}await S({entryPoints:[t],outfile:e,bundle:!0,format:"esm",platform:"node",external:[...s]});let n=await import(I(e).href);return await R(e),n}async function x(t,o,e){let r=(await J(t)).app;if(!r)throw new Error(`No named export "app" found in ${t}`);let s={info:{name:t.split(/[\\/]/).pop()||"Express App",schema:"https://schema.getpostman.com/json/collection/v2.1.0/collection.json"},item:[]},n={};console.log(" extractRoutes(app as Application): ",u(r));for(let{method:p,path:m}of u(r)){let d=m.split("/").filter(Boolean),c=d[0]||"/";n[c]||(n[c]={name:c,item:[]});let v={name:`${p} ${m}`,request:{method:p,header:[],url:{raw:`{{baseUrl}}${m}`,host:["{{baseUrl}}"],path:d}}};n[c].item.push(v)}for(let p of Object.keys(n))s.item.push(n[p]);e&&console.log(JSON.stringify(s,null,2)),await P(o,JSON.stringify(s,null,2),"utf-8")}var a=new N;a.name("express-to-postman").description("Generate a Postman Collection from an Express v5 app").version(f).showHelpAfterError().requiredOption("-i, --input <path>","Path to your Express app entry file (JS or TS)").option("-o, --output <path>","Output path for collection JSON","postman.collection.json").option("-v, --verbose","Enable verbose logging",!1);process.argv.length<=2&&(a.outputHelp(),process.exit(0));a.exitOverride(t=>{console.error(t.message),a.outputHelp(),process.exit(1)});a.parse(process.argv);var l=a.opts(),k=b(process.cwd(),l.input),y=b(process.cwd(),l.output);l.verbose&&console.log(`Loading app from: ${k}`);x(k,y,l.verbose).then(()=>{console.log(`\u2705 Postman collection written to ${y}`)}).catch(t=>{console.error("\u274C Error generating collection:",t),process.exit(1)});
//# sourceMappingURL=cli.js.map